@{
    ViewData["Title"] = "Home Page";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white text-center fs-4 fw-semibold">
                    💬 UTM 's minions chat
                </div>

                <div class="card-body" id="chatContainer" style="height: 400px; overflow-y: auto; background-color: #f9fafb;">
                    <ul id="messagesList" class="list-unstyled mb-0"></ul>
                </div>

                <div class="card-footer d-flex">
                    <input type="text" id="messageInput" class="form-control me-2" placeholder="Scrie un mesaj..." />
                    <button id="sendButton" class="btn btn-primary px-4">Trimite</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.0/signalr.min.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/chatHub")
        .build();

    // primirea mesajelor
    connection.on("ReceiveMessage", function (message) {
        const li = document.createElement("li");
        li.className = "p-2 mb-2 rounded-3 bg-light shadow-sm animate__animated animate__fadeInUp";
        li.textContent = message;
        document.getElementById("messagesList").appendChild(li);

        // scroll automat în jos
        const chatContainer = document.getElementById("chatContainer");
        chatContainer.scrollTop = chatContainer.scrollHeight;
    });

    connection.start().catch(err => console.error(err.toString()));

    // trimiterea mesajelor
    document.getElementById("sendButton").addEventListener("click", function () {
        const messageInput = document.getElementById("messageInput");
        const message = messageInput.value.trim();

        if (message) {
            connection.send("SendMessage", message).catch(err => console.error(err.toString()));
            messageInput.value = "";
        }
    });

    // apăsarea Enter pentru trimitere
    document.getElementById("messageInput").addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
            document.getElementById("sendButton").click();
        }
    });
</script>

<!-- Optional: animații pentru apariția mesajelor -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
